<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shared Creation - Sketch to Masterpiece</title>
  <meta name="description" content="Check out this AI-generated masterpiece!">
  
  <!-- Dynamic OG tags will be set by JavaScript -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="AI Masterpiece - Sketch to Masterpiece" id="ogTitle">
  <meta property="og:description" content="Check out this AI-generated artwork!" id="ogDescription">
  <meta property="og:image" content="" id="ogImage">
  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="AI Masterpiece - Sketch to Masterpiece" id="twitterTitle">
  <meta name="twitter:description" content="Check out this AI-generated artwork!" id="twitterDescription">
  <meta name="twitter:image" content="" id="twitterImage">
  
  <link rel="stylesheet" href="/style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    .share-page {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 40px 20px;
      background: var(--bg-primary);
    }
    
    .share-container {
      max-width: 800px;
      width: 100%;
      text-align: center;
    }
    
    .share-header {
      margin-bottom: 32px;
    }
    
    .share-header h1 {
      font-size: 2rem;
      margin-bottom: 8px;
      background: var(--accent-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .share-header p {
      color: var(--text-secondary);
    }
    
    .share-image-container {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-xl);
      padding: 24px;
      margin-bottom: 32px;
    }
    
    .share-image {
      max-width: 100%;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
    }
    
    .share-prompt {
      margin-top: 16px;
      padding: 12px 20px;
      background: var(--bg-tertiary);
      border-radius: var(--radius-md);
      color: var(--text-secondary);
      font-style: italic;
    }
    
    .share-meta {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      margin-top: 16px;
      color: var(--text-muted);
      font-size: 0.85rem;
    }
    
    .share-cta {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
    }
    
    .share-cta p {
      color: var(--text-secondary);
    }
    
    .try-btn {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 16px 32px;
      background: var(--accent-gradient);
      border: none;
      border-radius: var(--radius-lg);
      color: white;
      font-family: var(--font-body);
      font-size: 1.1rem;
      font-weight: 600;
      text-decoration: none;
      cursor: pointer;
      transition: all var(--transition);
    }
    
    .try-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-glow);
    }
    
    .share-loading {
      padding: 60px;
      color: var(--text-muted);
    }
    
    .share-error {
      padding: 60px;
      color: var(--text-muted);
    }
    
    .share-error h2 {
      color: var(--text-primary);
      margin-bottom: 12px;
    }
    
    .share-image {
      cursor: zoom-in;
      transition: transform 0.2s ease;
    }
    
    .share-image:hover {
      transform: scale(1.02);
    }
    
    .share-actions {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-top: 16px;
    }
    
    .share-action-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      font-family: var(--font-body);
      font-size: 0.9rem;
      cursor: pointer;
      transition: all var(--transition);
      text-decoration: none;
    }
    
    .share-action-btn:hover {
      background: var(--bg-hover);
      border-color: var(--accent);
    }
    
    .zoom-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      cursor: zoom-out;
    }
    
    .zoom-modal.active {
      opacity: 1;
      visibility: visible;
    }
    
    .zoom-modal img {
      max-width: 95vw;
      max-height: 95vh;
      object-fit: contain;
      border-radius: var(--radius-lg);
      box-shadow: 0 0 60px rgba(139, 92, 246, 0.3);
    }
    
    .zoom-close {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 44px;
      height: 44px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: var(--text-primary);
      transition: all var(--transition);
    }
    
    .zoom-close:hover {
      background: var(--bg-hover);
      border-color: var(--accent);
    }
    
    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      margin-top: 20px;
      color: var(--accent);
      text-decoration: none;
    }
    
    .back-link:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="share-page">
    <div class="share-container">
      <div class="share-header">
        <a href="/" style="text-decoration: none;">
          <h1>âœ¨ Sketch to Masterpiece</h1>
        </a>
        <p>AI-Generated Artwork</p>
      </div>
      
      <div id="shareContent">
        <div class="share-loading">
          <p>Loading creation...</p>
        </div>
      </div>
      
      <div class="share-cta">
        <p>Want to create your own masterpiece?</p>
        <a href="/" class="try-btn">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 3v18M3 12h18M5.6 5.6l12.8 12.8M18.4 5.6L5.6 18.4"/></svg>
          Try It Free
        </a>
      </div>
    </div>
  </div>
  
  <!-- Zoom Modal -->
  <div id="zoomModal" class="zoom-modal" onclick="closeZoom()">
    <button class="zoom-close" onclick="closeZoom()">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18M6 6l12 12"/></svg>
    </button>
    <img id="zoomImage" src="" alt="Zoomed image" onclick="event.stopPropagation()">
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
  
  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDx_MqAkpTHKGvov0A5QFtOGPtF7dmh-5I",
      authDomain: "cartoon-master-app.firebaseapp.com",
      projectId: "cartoon-master-app",
      storageBucket: "cartoon-master-app.firebasestorage.app",
      messagingSenderId: "49423499970",
      appId: "1:49423499970:web:adae705375ee86dc66715b"
    };
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    
    async function loadShare() {
      const shareContent = document.getElementById('shareContent');
      
      // Get share ID from URL path
      const pathParts = window.location.pathname.split('/');
      const shareId = pathParts[pathParts.length - 1];
      
      if (!shareId) {
        showError('No share ID provided');
        return;
      }
      
      try {
        const doc = await db.collection('shares').doc(shareId).get();
        
        if (!doc.exists) {
          showError('This creation was not found or has been removed.');
          return;
        }
        
        const data = doc.data();
        displayShare(data);
        
        // Update OG tags dynamically (won't help crawlers but good for JS-based sharing)
        if (data.imageUrl) {
          document.getElementById('ogImage').content = data.imageUrl;
          document.getElementById('twitterImage').content = data.imageUrl;
        }
        if (data.prompt) {
          const desc = `"${data.prompt}" - Created with Sketch to Masterpiece`;
          document.getElementById('ogDescription').content = desc;
          document.getElementById('twitterDescription').content = desc;
        }
        
      } catch (err) {
        console.error('Error loading share:', err);
        showError('Failed to load this creation.');
      }
    }
    
    function displayShare(data) {
      const shareContent = document.getElementById('shareContent');
      const createdAt = data.createdAt?.toDate?.() || new Date();
      const dateStr = createdAt.toLocaleDateString('en-US', { 
        month: 'short', 
        day: 'numeric', 
        year: 'numeric' 
      });
      
      shareContent.innerHTML = `
        <div class="share-image-container">
          <img src="${data.imageUrl}" alt="AI Generated Masterpiece" class="share-image" onclick="openZoom(this.src)">
          ${data.prompt ? `<div class="share-prompt">"${data.prompt}"</div>` : ''}
          <div class="share-meta">
            ${data.style ? `<span>Style: ${data.style}</span>` : ''}
            <span>Created ${dateStr}</span>
          </div>
          <div class="share-actions">
            <button class="share-action-btn" onclick="openZoom('${data.imageUrl}')">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/><path d="M11 8v6M8 11h6"/></svg>
              Zoom
            </button>
            <button class="share-action-btn" onclick="downloadImage('${data.imageUrl}')">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7,10 12,15 17,10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
              Download
            </button>
          </div>
        </div>
      `;
      
      // Store image URL for download
      window.currentImageUrl = data.imageUrl;
    }
    
    function showError(message) {
      const shareContent = document.getElementById('shareContent');
      shareContent.innerHTML = `
        <div class="share-error">
          <h2>Oops!</h2>
          <p>${message}</p>
          <a href="/" class="back-link">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
            Go to homepage
          </a>
        </div>
      `;
    }
    
    // Zoom modal functions
    function openZoom(imageUrl) {
      const modal = document.getElementById('zoomModal');
      const img = document.getElementById('zoomImage');
      img.src = imageUrl;
      modal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }
    
    function closeZoom() {
      const modal = document.getElementById('zoomModal');
      modal.classList.remove('active');
      document.body.style.overflow = '';
    }
    
    // Download function
    async function downloadImage(imageUrl) {
      try {
        const response = await fetch(imageUrl);
        const blob = await response.blob();
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `masterpiece-${Date.now()}.png`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
      } catch (err) {
        console.error('Download failed:', err);
        // Fallback: open in new tab
        window.open(imageUrl, '_blank');
      }
    }
    
    // Close zoom on escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeZoom();
    });
    
    // Load on page ready
    loadShare();
  </script>
</body>
</html>
